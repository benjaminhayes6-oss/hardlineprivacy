name: Hardline Executive Revenue Monitor

on:
  schedule:
    - cron: '0 9 * * *'
  workflow_dispatch:

permissions:
  contents: read
  issues: write

jobs:
  executive-monitor:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Check homepage health
        run: |
          STATUS=$(curl -s -o /dev/null -w "%{http_code}" https://www.hardlineprivacy.com)
          echo "Homepage: $STATUS"

          if [ "$STATUS" != "200" ]; then
            echo "HOME_FAIL=true" >> $GITHUB_ENV
          fi

      - name: Verify primary CTA exists
        run: |
          curl -s https://www.hardlineprivacy.com > homepage.html
          grep -qi "Run Free Exposure Scan" homepage.html || echo "CTA_FAIL=true" >> $GITHUB_ENV

      - name: Verify pricing trust elements
        run: |
          curl -s https://www.hardlineprivacy.com/pricing > pricing.html

          grep -qi "Most Popular" pricing.html || echo "ANCHOR_FAIL=true" >> $GITHUB_ENV
          grep -qi "checkout" pricing.html || echo "CHECKOUT_FAIL=true" >> $GITHUB_ENV

      - name: Executive Alert if Revenue Risk
        if: env.HOME_FAIL == 'true' || env.CTA_FAIL == 'true' || env.ANCHOR_FAIL == 'true' || env.CHECKOUT_FAIL == 'true'
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: "Executive Revenue Risk Detected",
              body: "Revenue-impacting element missing. Review homepage or pricing immediately."
            });

      - name: Executive Monitor Complete
        run: echo "Executive revenue oversight active"
